<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nedbank Online Banking</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
        }
        .hidden {
            display: none !important;
        }
        /* Main Page Styles */
        .main-page {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .navbar {
            background-color: #00823e;
            color: #fff;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .navbar img {
            max-width: 120px;
        }
        .navbar ul {
            list-style: none;
            display: flex;
            gap: 20px;
        }
        .navbar a {
            color: #fff;
            text-decoration: none;
            font-size: 0.9em;
            cursor: pointer;
        }
        .navbar a:hover {
            text-decoration: underline;
        }
        .hero {
            background: linear-gradient(rgba(0, 130, 62, 0.8), rgba(0, 130, 62, 0.8)), url('https://via.placeholder.com/1200x400?text=Hero+Image');
            background-size: cover;
            background-position: center;
            color: #fff;
            text-align: center;
            padding: 50px 20px;
        }
        .hero h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        .hero p {
            font-size: 1em;
            margin-bottom: 20px;
        }
        .hero button {
            background-color: #fff;
            color: #00823e;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
        .hero button:hover {
            background-color: #f0f0f0;
        }
        .services {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .service-card {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        .service-card h3 {
            color: #00823e;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .service-card p {
            font-size: 0.9em;
            color: #666;
        }
        .affiliation {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .affiliation p {
            font-size: 1em;
            color: #00823e;
            font-weight: bold;
        }
        .footer {
            background-color: #00823e;
            color: #fff;
            text-align: center;
            padding: 15px;
            margin-top: auto;
        }
        .footer a {
            color: #fff;
            text-decoration: none;
            margin: 0 10px;
        }
        .footer a:hover {
            text-decoration: underline;
        }
        /* Form and Dashboard Styles */
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f4f4;
            padding: 15px;
        }
        .form-container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        .form-container img {
            max-width: 120px;
            margin-bottom: 15px;
        }
        .form-container h2 {
            color: #00823e;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        .form-container label {
            display: block;
            text-align: left;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9em;
        }
        .form-container input, .form-container select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .form-container button {
            background-color: #00823e;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 4px;
            width: 100%;
            cursor: pointer;
            font-size: 1em;
        }
        .form-container button:hover {
            background-color: #006633;
        }
        .form-container a {
            color: #00823e;
            text-decoration: none;
            display: block;
            margin-top: 10px;
            font-size: 0.9em;
            cursor: pointer;
        }
        .form-container a:hover {
            text-decoration: underline;
        }
        .error, .success {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .error {
            color: red;
            background-color: #ffebee;
        }
        .success {
            color: green;
            background-color: #e8f5e9;
        }
        .dashboard, .admin-dashboard {
            max-width: 1000px;
            margin: 15px auto;
            padding: 15px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #00823e;
            color: #fff;
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .header h1 {
            margin: 0;
            font-size: 1.2em;
        }
        .logout-btn {
            background-color: #fff;
            color: #00823e;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .logout-btn:hover {
            background-color: #f0f0f0;
        }
        .profile-card, .balance-card, .transactions, .transfer-form, .admin-section {
            background-color: #fff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
        }
        .profile-card h3, .balance-card h3, .transactions h3, .transfer-form h3, .admin-section h3 {
            color: #00823e;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .profile-info p {
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        .edit-profile-btn {
            background-color: #00823e;
            color: #fff;
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9em;
        }
        .edit-profile-btn:hover {
            background-color: #006633;
        }
        .balance {
            font-size: 1.8em;
            color: #00823e;
            margin: 10px 0;
        }
        .transaction-list {
            list-style: none;
        }
        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
        }
        .transfer-form label, .admin-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9em;
        }
        .transfer-form input, .transfer-form select, .admin-form input, .admin-form select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .transfer-btn, .admin-btn {
            background-color: #00823e;
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            margin-right: 8px;
        }
        .transfer-btn:hover, .admin-btn:hover {
            background-color: #006633;
        }
        .delete-btn {
            background-color: #d32f2f;
            color: #fff;
        }
        .delete-btn:hover {
            background-color: #b71c1c;
        }
        .freeze-btn {
            background-color: #0288d1;
            color: #fff;
        }
        .freeze-btn:hover {
            background-color: #01579b;
        }
        .user-list {
            list-style: none;
        }
        .user-item {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
        }
        .user-item span {
            flex: 1 1 120px;
            margin-right: 8px;
        }
        .user-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .admin-form, .deposit-form {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }
        .admin-form input, .deposit-form input {
            flex: 1;
            min-width: 100px;
        }
        .edit-profile-form, .admin-edit-form {
            margin-top: 15px;
        }
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 10px;
            }
            .navbar ul {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            .hero {
                padding: 30px 10px;
            }
            .hero h1 {
                font-size: 1.5em;
            }
            .services, .affiliation {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 10px;
            }
            .form-container {
                padding: 15px;
                max-width: 100%;
            }
            .dashboard, .admin-dashboard {
                padding: 10px;
            }
            .header {
                flex-direction: column;
                gap: 8px;
            }
            .header h1 {
                font-size: 1em;
            }
            .profile-card, .balance-card, .transactions, .transfer-form, .admin-section {
                padding: 10px;
            }
            .user-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .user-actions {
                margin-top: 8px;
                width: 100%;
                justify-content: flex-start;
            }
            .admin-form, .deposit-form {
                flex-direction: column;
            }
            .admin-form input, .admin-form select, .deposit-form input, .deposit-form button {
                width: 100%;
            }
        }
        @media (max-width: 480px) {
            .navbar img, .form-container img {
                max-width: 100px;
            }
            .hero h1 {
                font-size: 1.2em;
            }
            .form-container h2 {
                font-size: 1.2em;
            }
            .balance {
                font-size: 1.5em;
            }
            .affiliation p {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <!-- Main Page -->
    <div id="mainPage" class="main-page">
        <div class="navbar">
            <img src="https://via.placeholder.com/150x50/00823e/fff?text=Nedbank" alt="Nedbank Logo">
            <ul>
                <li><a href="#" onclick="showMain()">Home</a></li>
                <li><a href="#" onclick="showMain()">Services</a></li>
                <li><a href="#" onclick="showMain()">Contact</a></li>
                <li><a href="#" onclick="showLogin()">Log In</a></li>
                <li><a href="#" onclick="showSignup()">Sign Up</a></li>
            </ul>
        </div>
        <div class="hero">
            <h1>Welcome to Nedbank Online Banking</h1>
            <p>Securely manage your finances with our easy-to-use platform. Join millions of customers today.</p>
            <button onclick="showSignup()">Get Started</button>
        </div>
        <div class="services">
            <div class="service-card">
                <h3>Online Banking</h3>
                <p>Access your account anytime, anywhere with our secure platform.</p>
            </div>
            <div class="service-card">
                <h3>Fast Transfers</h3>
                <p>Send money to any account quickly and securely.</p>
            </div>
            <div class="service-card">
                <h3>Account Management</h3>
                <p>Manage your profile, view balances, and track transactions.</p>
            </div>
        </div>
        <div class="affiliation">
            <p>Affiliated with Interpol for secure withdrawal of recovery funds</p>
        </div>
        <div class="footer">
            <p>Contact us: support@nedbank.com | 0800 555 111</p>
            <p><a href="#">Privacy Policy</a> | <a href="#">Terms of Use</a></p>
        </div>
    </div>

    <!-- Sign-Up Page -->
    <div id="signupPage" class="container hidden">
        <div class="form-container">
            <img src="https://via.placeholder.com/150x50/00823e/fff?text=Nedbank" alt="Nedbank Logo">
            <h2>Sign Up for Nedbank Online Banking</h2>
            <p style="font-size: 0.8em; color: #666;">Requirements: Must be 18+, provide SA ID or Passport, contact details.</p>
            <form id="signupForm">
                <label for="fullName">Full Name (as per ID)</label>
                <input type="text" id="fullName" name="fullName" placeholder="Enter your full name" required>
                <label for="idType">ID Type</label>
                <select id="idType" name="idType" required>
                    <option value="">Select ID Type</option>
                    <option value="sa_id">South African ID</option>
                    <option value="passport">Foreign Passport</option>
                </select>
                <label for="idNumber">ID/Passport Number</label>
                <input type="text" id="idNumber" name="idNumber" placeholder="Enter ID or Passport number" pattern="[0-9A-Za-z]{10,20}" required title="10-20 alphanumeric characters">
                <label for="dob">Date of Birth</label>
                <input type="date" id="dob" name="dob" required>
                <label for="address">Residential Address</label>
                <input type="text" id="address" name="address" placeholder="Enter your address" required>
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" pattern="[0-9]{10}" required title="10-digit number">
                <label for="signupEmail">Email</label>
                <input type="email" id="signupEmail" name="email" placeholder="Enter your email" required>
                <label for="signupUsername">Username</label>
                <input type="text" id="signupUsername" name="username" placeholder="Choose a username" required>
                <label for="signupPassword">Password</label>
                <input type="password" id="signupPassword" name="password" placeholder="Choose a password" minlength="8" required>
                <label for="signupConfirmPassword">Confirm Password</label>
                <input type="password" id="signupConfirmPassword" name="confirmPassword" placeholder="Confirm your password" required>
                <label for="securityQuestion">Security Question</label>
                <select id="securityQuestion" name="securityQuestion" required>
                    <option value="">Select a security question</option>
                    <option value="pet">What is the name of your first pet?</option>
                    <option value="school">What is the name of your primary school?</option>
                    <option value="city">In which city were you born?</option>
                </select>
                <label for="securityAnswer">Security Answer</label>
                <input type="text" id="securityAnswer" name="securityAnswer" placeholder="Enter your answer" required>
                <button type="submit">Submit Registration</button>
            </form>
            <div id="signupMessage" class="error hidden"></div>
            <a href="#" onclick="showLogin()">Already have an account? Log In</a>
        </div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="container hidden">
        <div class="form-container">
            <img src="https://via.placeholder.com/150x50/00823e/fff?text=Nedbank" alt="Nedbank Logo">
            <h2>Nedbank Online Banking Login</h2>
            <form id="loginForm">
                <label for="loginUsername">Username</label>
                <input type="text" id="loginUsername" name="username" placeholder="Enter your username" required>
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" name="password" placeholder="Enter your password" required>
                <button type="submit">Log In</button>
            </form>
            <div id="loginMessage" class="error hidden"></div>
            <a href="#" onclick="showSignup()">Don't have an account? Sign Up</a>
            <a href="#" onclick="showResetPassword()">Forgot Password?</a>
        </div>
    </div>

    <!-- Reset Password Page -->
    <div id="resetPasswordPage" class="container hidden">
        <div class="form-container">
            <img src="https://via.placeholder.com/150x50/00823e/fff?text=Nedbank" alt="Nedbank Logo">
            <h2>Reset Password</h2>
            <p style="font-size: 0.8em; color: #666;">Enter your email to start the reset process.</p>
            <form id="resetEmailForm">
                <label for="resetEmail">Email</label>
                <input type="email" id="resetEmail" name="email" placeholder="Enter your email" required>
                <button type="submit">Verify Email</button>
            </form>
            <div id="resetEmailMessage" class="error hidden"></div>
            <div id="resetVerificationSection" class="hidden">
                <h3>Verify Identity</h3>
                <label for="securityQuestionSelect">Security Question</label>
                <select id="securityQuestionSelect" name="securityQuestion" disabled>
                    <option value="">Loading...</option>
                </select>
                <label for="securityAnswerInput">Security Answer</label>
                <input type="text" id="securityAnswerInput" placeholder="Enter your answer" required>
                <label for="newPassword">New Password</label>
                <input type="password" id="newPassword" name="newPassword" placeholder="Enter new password" minlength="8" required>
                <label for="confirmNewPassword">Confirm New Password</label>
                <input type="password" id="confirmNewPassword" name="confirmNewPassword" placeholder="Confirm new password" required>
                <button onclick="verifyReset()">Reset Password</button>
            </div>
            <a href="#" onclick="showLogin()">Back to Login</a>
        </div>
    </div>

    <!-- User Dashboard -->
    <div id="userDashboard" class="dashboard hidden">
        <div class="header">
            <h1>Welcome to Nedbank Online Banking</h1>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
        <div class="profile-card">
            <h3>User Profile</h3>
            <div class="profile-info">
                <p><strong>Username:</strong> <span id="profileUsername"></span></p>
                <p><strong>Email:</strong> <span id="profileEmail"></span></p>
            </div>
            <button class="edit-profile-btn" onclick="toggleEditProfile()">Edit Profile</button>
            <form id="editProfileForm" class="edit-profile-form hidden">
                <label for="editEmail">New Email</label>
                <input type="email" id="editEmail" placeholder="Update your email">
                <label for="editPassword">New Password</label>
                <input type="password" id="editPassword" placeholder="Update your password" minlength="8">
                <label for="editConfirmPassword">Confirm New Password</label>
                <input type="password" id="editConfirmPassword" placeholder="Confirm new password">
                <label for="editSecurityAnswer">Security Answer (optional)</label>
                <input type="text" id="editSecurityAnswer" placeholder="Update your security answer">
                <button type="submit">Save Changes</button>
            </form>
            <div id="editMessage" class="success hidden"></div>
        </div>
        <div class="balance-card">
            <h3>Account Balance</h3>
            <div class="balance" id="userBalance">R 0.00</div>
            <p>Current Checking Account</p>
        </div>
        <div class="transactions">
            <h3>Recent Transactions</h3>
            <button class="transfer-btn" style="width: auto; margin-bottom: 10px;" onclick="exportTransactions()">Export Transaction History</button>
            <ul class="transaction-list" id="userTransactions"></ul>
        </div>
        <div class="transfer-form">
            <h3>Transfer Funds</h3>
            <form id="transferForm">
                <label for="toAccount">To Account Number</label>
                <input type="text" id="toAccount" name="toAccount" placeholder="e.g., 123456789" required>
                <label for="amount">Amount (R)</label>
                <input type="number" id="amount" name="amount" placeholder="e.g., 500" step="0.01" min="0" required>
                <button type="submit" class="transfer-btn">Transfer</button>
            </form>
            <div id="transferMessage" class="success hidden"></div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="admin-dashboard hidden">
        <div class="header">
            <h1>Nedbank Admin Dashboard</h1>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
        <div class="admin-section">
            <h3>Pending Registrations</h3>
            <ul class="user-list" id="pendingList"></ul>
        </div>
        <div class="admin-section">
            <h3>Approved Users</h3>
            <ul class="user-list" id="userList"></ul>
        </div>
        <div class="admin-section">
            <h3>All Transactions</h3>
            <ul class="transaction-list" id="allTransactions"></ul>
        </div>
    </div>

    <script>
        // User data storage
        let currentUser = null;
        let resetUser = null;
        const usersKey = 'nedbank_users';
        const getUsers = () => {
            try {
                return JSON.parse(localStorage.getItem(usersKey)) || [];
            } catch (e) {
                console.error('Error accessing localStorage:', e);
                return [];
            }
        };
        const saveUsers = (users) => {
            try {
                localStorage.setItem(usersKey, JSON.stringify(users));
            } catch (e) {
                console.error('Error saving to localStorage:', e);
                showMessage('loginMessage', 'Storage error. Clear browser data.', 'error');
            }
        };

        // Initialize admin (credentials not exposed)
        let users = getUsers();
        if (!users.find(u => u.username === 'admin')) {
            users.push({
                username: 'admin',
                email: 'admin@nedbank.com',
                password: 'admin',
                role: 'admin',
                status: 'approved',
                securityQuestion: 'pet',
                securityAnswer: 'admin',
                frozen: false
            });
            saveUsers(users);
        }

        // User account data
        const getUserData = (username) => {
            try {
                return JSON.parse(localStorage.getItem(`nedbank_${username}`)) || {
                    balance: 0.00,
                    transactions: []
                };
            } catch (e) {
                console.error('Error accessing user data:', e);
                return { balance: 0.00, transactions: [] };
            }
        };
        const saveUserData = (username, data) => {
            try {
                localStorage.setItem(`nedbank_${username}`, JSON.stringify(data));
            } catch (e) {
                console.error('Error saving user data:', e);
                showMessage('loginMessage', 'Storage error. Clear browser data.', 'error');
            }
        };

        // Navigation
        function showMain() {
            console.log('Navigating to Main Page');
            hideAllPages();
            document.getElementById('mainPage').classList.remove('hidden');
        }
        function showSignup() {
            console.log('Navigating to Sign-Up Page');
            hideAllPages();
            document.getElementById('signupPage').classList.remove('hidden');
            document.getElementById('signupMessage').classList.add('hidden');
        }
        function showLogin() {
            console.log('Navigating to Login Page');
            hideAllPages();
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('loginMessage').classList.add('hidden');
        }
        function showResetPassword() {
            console.log('Navigating to Reset Password Page');
            hideAllPages();
            document.getElementById('resetPasswordPage').classList.remove('hidden');
            document.getElementById('resetEmailMessage').classList.add('hidden');
            document.getElementById('resetVerificationSection').classList.add('hidden');
        }
        function hideAllPages() {
            console.log('Hiding all pages');
            document.querySelectorAll('.main-page, .container, .dashboard, .admin-dashboard').forEach(page => {
                page.classList.add('hidden');
            });
        }

        // Message display
        function showMessage(id, text, type) {
            const div = document.getElementById(id);
            div.textContent = text;
            div.className = type;
            div.classList.remove('hidden');
            setTimeout(() => div.classList.add('hidden'), 3000);
        }

        // Event delegation for navigation
        document.addEventListener('click', (e) => {
            const target = e.target.closest('a, button');
            if (!target) return;
            if (target.getAttribute('onclick') === 'showMain()') {
                e.preventDefault();
                showMain();
            } else if (target.getAttribute('onclick') === 'showSignup()') {
                e.preventDefault();
                showSignup();
            } else if (target.getAttribute('onclick') === 'showLogin()') {
                e.preventDefault();
                showLogin();
            } else if (target.getAttribute('onclick') === 'showResetPassword()') {
                e.preventDefault();
                showResetPassword();
            }
        });

        // Sign-up
        document.getElementById('signupForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Sign-up form submitted');
            const fullName = document.getElementById('fullName').value.trim();
            const idType = document.getElementById('idType').value;
            const idNumber = document.getElementById('idNumber').value.trim();
            const dob = new Date(document.getElementById('dob').value);
            const address = document.getElementById('address').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const username = document.getElementById('signupUsername').value.trim();
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const securityQuestion = document.getElementById('securityQuestion').value;
            const securityAnswer = document.getElementById('securityAnswer').value.trim();

            const age = (new Date() - dob) / (365.25 * 24 * 60 * 60 * 1000);
            if (age < 18) {
                showMessage('signupMessage', 'You must be 18 or older.', 'error');
                return;
            }
            if (password !== confirmPassword) {
                showMessage('signupMessage', 'Passwords do not match.', 'error');
                return;
            }
            if (!idNumber.match(/[0-9A-Za-z]{10,20}/)) {
                showMessage('signupMessage', 'Invalid ID/Passport number.', 'error');
                return;
            }
            if (!phone.match(/[0-9]{10}/)) {
                showMessage('signupMessage', 'Invalid phone number (10 digits).', 'error');
                return;
            }

            let users = getUsers();
            if (users.find(u => u.username === username)) {
                showMessage('signupMessage', 'Username already exists.', 'error');
                return;
            }

            users.push({
                fullName, idType, idNumber, dob: dob.toISOString(), address, phone, email, username,
                password, role: 'user', status: 'pending', securityQuestion, securityAnswer, frozen: false
            });
            saveUsers(users);
            saveUserData(username, { balance: 0.00, transactions: [] });

            showMessage('signupMessage', 'Registration submitted. Awaiting admin approval.', 'success');
            document.getElementById('signupForm').reset();
            setTimeout(showLogin, 2000);
        });

        // Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Login form submitted');
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            const users = getUsers();
            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                if (user.frozen) {
                    showMessage('loginMessage', 'Account is frozen. Contact admin.', 'error');
                    return;
                }
                if (user.role === 'user' && user.status !== 'approved') {
                    showMessage('loginMessage', 'Account pending admin approval.', 'error');
                    return;
                }
                currentUser = user;
                const userData = getUserData(username);
                hideAllPages();
                if (user.role === 'admin') {
                    console.log('Showing admin dashboard');
                    document.getElementById('adminDashboard').classList.remove('hidden');
                    updateAdminDashboard();
                } else {
                    console.log('Showing user dashboard');
                    document.getElementById('userDashboard').classList.remove('hidden');
                    updateProfile();
                    updateBalance(userData.balance);
                    updateTransactions(userData.transactions);
                }
            } else {
                showMessage('loginMessage', 'Invalid username or password.', 'error');
            }
        });

        // Reset Password - Email Verification
        document.getElementById('resetEmailForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Reset email form submitted');
            const email = document.getElementById('resetEmail').value.trim();
            const users = getUsers();
            resetUser = users.find(u => u.email === email && u.role !== 'admin');
            if (resetUser) {
                document.getElementById('resetVerificationSection').classList.remove('hidden');
                document.getElementById('securityQuestionSelect').value = resetUser.securityQuestion;
                document.getElementById('securityQuestionSelect').disabled = true;
                showMessage('resetEmailMessage', 'Please verify your identity.', 'success');
            } else {
                showMessage('resetEmailMessage', 'Email not found.', 'error');
            }
        });

        // Reset Password - Verify and Update
        function verifyReset() {
            console.log('Reset password verification submitted');
            const answer = document.getElementById('securityAnswerInput').value.trim();
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;

            if (answer.toLowerCase() !== resetUser.securityAnswer.toLowerCase()) {
                showMessage('resetEmailMessage', 'Incorrect security answer.', 'error');
                return;
            }
            if (newPassword !== confirmPassword) {
                showMessage('resetEmailMessage', 'Passwords do not match.', 'error');
                return;
            }
            if (newPassword.length < 8) {
                showMessage('resetEmailMessage', 'Password must be at least 8 characters.', 'error');
                return;
            }

            let users = getUsers();
            const userIndex = users.findIndex(u => u.username === resetUser.username);
            users[userIndex].password = newPassword;
            saveUsers(users);
            resetUser = null;
            showMessage('resetEmailMessage', 'Password reset successfully! Returning to login.', 'success');
            document.getElementById('resetEmailForm').reset();
            document.getElementById('resetVerificationSection').classList.add('hidden');
            setTimeout(showLogin, 2000);
        }

        // Update user profile
        function updateProfile() {
            console.log('Updating user profile');
            document.getElementById('profileUsername').textContent = currentUser.username;
            document.getElementById('profileEmail').textContent = currentUser.email;
        }

        // Toggle edit profile form
        function toggleEditProfile() {
            console.log('Toggling edit profile form');
            const form = document.getElementById('editProfileForm');
            form.classList.toggle('hidden');
            document.getElementById('editMessage').classList.add('hidden');
        }

        // Edit profile
        document.getElementById('editProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Edit profile form submitted');
            const newEmail = document.getElementById('editEmail').value.trim();
            const newPassword = document.getElementById('editPassword').value;
            const confirmPassword = document.getElementById('editConfirmPassword').value;
            const newSecurityAnswer = document.getElementById('editSecurityAnswer').value.trim();

            if (newPassword && newPassword !== confirmPassword) {
                showMessage('editMessage', 'Passwords do not match.', 'error');
                return;
            }
            if (newPassword && newPassword.length < 8) {
                showMessage('editMessage', 'Password must be at least 8 characters.', 'error');
                return;
            }

            let users = getUsers();
            const userIndex = users.findIndex(u => u.username === currentUser.username);
            if (newEmail) users[userIndex].email = newEmail;
            if (newPassword) users[userIndex].password = newPassword;
            if (newSecurityAnswer) users[userIndex].securityAnswer = newSecurityAnswer;
            saveUsers(users);
            currentUser = users[userIndex];
            updateProfile();

            showMessage('editMessage', 'Profile updated successfully!', 'success');
            document.getElementById('editProfileForm').reset();
            setTimeout(toggleEditProfile, 2000);
        });

        // Update balance
        function updateBalance(balance) {
            console.log('Updating balance:', balance);
            document.getElementById('userBalance').textContent = `R ${balance.toFixed(2)}`;
        }

        // Update transactions
        function updateTransactions(transactions) {
            console.log('Updating transactions:', transactions);
            const list = document.getElementById('userTransactions');
            list.innerHTML = '';
            transactions.slice(-5).forEach(tx => {
                const li = document.createElement('li');
                li.className = 'transaction-item';
                li.innerHTML = `<span>${tx.desc}</span><span>${tx.amount >= 0 ? '+' : ''}R ${Math.abs(tx.amount).toFixed(2)}</span>`;
                list.appendChild(li);
            });
        }

        // Transfer
        document.getElementById('transferForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Transfer form submitted');
            const toAccount = document.getElementById('toAccount').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);

            const userData = getUserData(currentUser.username);
            if (isNaN(amount) || amount <= 0) {
                showMessage('transferMessage', 'Invalid amount.', 'error');
                return;
            }
            if (amount > userData.balance) {
                showMessage('transferMessage', 'Insufficient funds.', 'error');
                return;
            }

            userData.balance -= amount;
            userData.transactions.unshift({ desc: `Transfer to ${toAccount}`, amount: -amount });
            saveUserData(currentUser.username, userData);
            updateBalance(userData.balance);
            updateTransactions(userData.transactions);

            showMessage('transferMessage', `Transfer of R ${amount.toFixed(2)} to ${toAccount} successful!`, 'success');
            document.getElementById('transferForm').reset();
        });

        // Export transactions
        function exportTransactions() {
            console.log('Exporting transactions');
            const userData = getUserData(currentUser.username);
            const blob = new Blob([JSON.stringify(userData.transactions, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'transactions.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Update admin dashboard
        function updateAdminDashboard() {
            console.log('Updating admin dashboard');
            const users = getUsers().filter(u => u.role !== 'admin');
            const userList = document.getElementById('userList');
            const pendingList = document.getElementById('pendingList');
            const allTransactionsList = document.getElementById('allTransactions');
            userList.innerHTML = '';
            pendingList.innerHTML = '';
            allTransactionsList.innerHTML = '';

            users.forEach(user => {
                const li = document.createElement('li');
                li.className = 'user-item';
                const balance = getUserData(user.username).balance;
                li.innerHTML = `
                    <span><strong>Username:</strong> ${user.username}</span>
                    <span><strong>Email:</strong> ${user.email}</span>
                    <span><strong>Status:</strong> ${user.status}</span>
                    <span><strong>Balance:</strong> R ${balance.toFixed(2)}</span>
                    <span><strong>Frozen:</strong> ${user.frozen ? 'Yes' : 'No'}</span>
                    <div class="user-actions">
                        ${user.status === 'pending' ? `<button class="admin-btn" onclick="approveUser('${user.username}')">Approve</button><button class="admin-btn delete-btn" onclick="rejectUser('${user.username}')">Reject</button>` : ''}
                        <button class="admin-btn delete-btn" onclick="deleteUser('${user.username}')">Delete</button>
                        <button class="admin-btn freeze-btn" onclick="toggleFreezeUser('${user.username}')">${user.frozen ? 'Unfreeze' : 'Freeze'}</button>
                        <button class="admin-btn" onclick="showEditUser('${user.username}')">Edit</button>
                    </div>
                    <form class="deposit-form" onsubmit="manualDeposit(event, '${user.username}')">
                        <input type="number" placeholder="Deposit Amount (R)" step="0.01" min="0" required>
                        <button type="submit" class="admin-btn">Deposit</button>
                    </form>
                    <form class="deposit-form" onsubmit="manualWithdraw(event, '${user.username}')">
                        <input type="number" placeholder="Withdraw Amount (R)" step="0.01" min="0" required>
                        <button type="submit" class="admin-btn">Withdraw</button>
                    </form>
                    <form class="admin-edit-form hidden" id="editUserForm_${user.username}">
                        <label for="editUserEmail_${user.username}">Email</label>
                        <input type="email" id="editUserEmail_${user.username}" value="${user.email}">
                        <label for="editUserSecurityQuestion_${user.username}">Security Question</label>
                        <select id="editUserSecurityQuestion_${user.username}">
                            <option value="pet" ${user.securityQuestion === 'pet' ? 'selected' : ''}>What is the name of your first pet?</option>
                            <option value="school" ${user.securityQuestion === 'school' ? 'selected' : ''}>What is the name of your primary school?</option>
                            <option value="city" ${user.securityQuestion === 'city' ? 'selected' : ''}>In which city were you born?</option>
                        </select>
                        <label for="editUserSecurityAnswer_${user.username}">Security Answer</label>
                        <input type="text" id="editUserSecurityAnswer_${user.username}" value="${user.securityAnswer}">
                        <button type="submit" class="admin-btn">Save</button>
                    </form>
                `;
                if (user.status === 'pending') {
                    pendingList.appendChild(li);
                } else {
                    userList.appendChild(li);
                }
            });

            // All transactions
            users.forEach(user => {
                const userData = getUserData(user.username);
                userData.transactions.forEach(tx => {
                    const li = document.createElement('li');
                    li.className = 'transaction-item';
                    li.innerHTML = `<span>${user.username}: ${tx.desc}</span><span>${tx.amount >= 0 ? '+' : ''}R ${Math.abs(tx.amount).toFixed(2)}</span>`;
                    allTransactionsList.appendChild(li);
                });
            });
        }

        // Approve user
        function approveUser(username) {
            console.log('Approving user:', username);
            let users = getUsers();
            const userIndex = users.findIndex(u => u.username === username);
            if (userIndex !== -1) {
                users[userIndex].status = 'approved';
                const userData = getUserData(username);
                userData.balance = 10000.00;
                userData.transactions.push({ desc: 'Initial Deposit', amount: 10000.00 });
                saveUsers(users);
                saveUserData(username, userData);
                updateAdminDashboard();
            }
        }

        // Reject user
        function rejectUser(username) {
            console.log('Rejecting user:', username);
            if (confirm(`Reject ${username}'s registration?`)) {
                deleteUser(username);
            }
        }

        // Delete user
        function deleteUser(username) {
            console.log('Deleting user:', username);
            let users = getUsers();
            users = users.filter(u => u.username !== username);
            saveUsers(users);
            localStorage.removeItem(`nedbank_${username}`);
            updateAdminDashboard();
        }

        // Toggle freeze user
        function toggleFreezeUser(username) {
            console.log('Toggling freeze for user:', username);
            let users = getUsers();
            const userIndex = users.findIndex(u => u.username === username);
            if (userIndex !== -1) {
                users[userIndex].frozen = !users[userIndex].frozen;
                saveUsers(users);
                updateAdminDashboard();
            }
        }

        // Show edit user form
        function showEditUser(username) {
            console.log('Showing edit form for user:', username);
            const form = document.getElementById(`editUserForm_${username}`);
            form.classList.toggle('hidden');
            form.onsubmit = (e) => {
                e.preventDefault();
                console.log('Editing user:', username);
                const newEmail = document.getElementById(`editUserEmail_${username}`).value.trim();
                const newSecurityQuestion = document.getElementById(`editUserSecurityQuestion_${username}`).value;
                const newSecurityAnswer = document.getElementById(`editUserSecurityAnswer_${username}`).value.trim();

                let users = getUsers();
                const userIndex = users.findIndex(u => u.username === username);
                if (newEmail) users[userIndex].email = newEmail;
                if (newSecurityQuestion) users[userIndex].securityQuestion = newSecurityQuestion;
                if (newSecurityAnswer) users[userIndex].securityAnswer = newSecurityAnswer;
                saveUsers(users);
                updateAdminDashboard();
                alert(`User ${username} updated successfully.`);
            };
        }

        // Manual deposit
        function manualDeposit(event, username) {
            event.preventDefault();
            console.log('Depositing for user:', username);
            const amountInput = event.target.querySelector('input');
            const amount = parseFloat(amountInput.value);
            if (isNaN(amount) || amount <= 0) {
                alert('Invalid amount.');
                return;
            }
            const userData = getUserData(username);
            userData.balance += amount;
            userData.transactions.unshift({ desc: `Admin Deposit`, amount: amount });
            saveUserData(username, userData);
            amountInput.value = '';
            updateAdminDashboard();
            alert(`Deposited R ${amount.toFixed(2)} to ${username}.`);
        }

        // Manual withdraw
        function manualWithdraw(event, username) {
            event.preventDefault();
            console.log('Withdrawing for user:', username);
            const amountInput = event.target.querySelector('input');
            const amount = parseFloat(amountInput.value);
            const userData = getUserData(username);
            if (isNaN(amount) || amount <= 0) {
                alert('Invalid amount.');
                return;
            }
            if (amount > userData.balance) {
                alert('Insufficient funds.');
                return;
            }
            userData.balance -= amount;
            userData.transactions.unshift({ desc: `Admin Withdrawal`, amount: -amount });
            saveUserData(username, userData);
            amountInput.value = '';
            updateAdminDashboard();
            alert(`Withdrew R ${amount.toFixed(2)} from ${username}.`);
        }

        // Logout
        function logout() {
            console.log('Logging out');
            currentUser = null;
            resetUser = null;
            hideAllPages();
            showMain();
            document.getElementById('loginForm').reset();
            document.getElementById('editProfileForm').reset();
        }

        // Initialize main page
        console.log('Initializing main page');
        showMain();
    </script>
</body>
</html>
